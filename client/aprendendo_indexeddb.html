<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprendendo IndexedDB</title>
</head>
<body>
    <script src="js/app/models/Negociacao.js"></script>
<script>

    //IDBDatabase
    //Criando uma instnacia para conexão com o Banco de Dados
    var connection;

    //Requisição de abertura para banco de dados
    var openRequest = window.indexedDB.open('serverJerry', 1);//Entre parênteses ('Nome do banco', Version do banco)Obs: Alterar o número da versão p/ cada alteração ser processada dentro do banco

    //Criando, alterando ou atualizando um banco de dados já existente
    openRequest.onupgradeneeded = ((e) => {

        console.log('Criando, alterando ou atualizando um Banco de Dados já existente');

        let minhaConnection = e.target.result;

        if(minhaConnection.objectStoreNames.contains('negociacoes')) {

            minhaConnection.deleteObjectStore('negociacoes');
        }

        minhaConnection.createObjectStore('negociacoes', {autoIncrement: true});       
    });

    //Executado sempre que houver êxito na conexão
    openRequest.onsuccess = ((e) => {

        console.log('Conexão obtida com sucesso');

        connection = e.target.result;
    });

    //Executado se hpuver algum erro
    openRequest.onerror = ((e) => {

        console.log(e.target.error);
    });

    function adiciona() {

        let transaction = connection.transaction(['negociacoes'], 'readwrite');

        let store = transaction.objectStore('negociacoes');

        let negociacao = new Negociacao('Bank Bilbao Vizcaya Argent. SA', 'Espanha', new Date(), -2.400, 'NYSE', 'BBVA', -7.05, 15, 31.672);

        let request = store.add(negociacao);

        request.onsuccess = ((e) => {

            console.log('Negociação inserida com sucesso');
        });

        request.onerror = ((e) => {

            console.log('Não foi possível incluir a negociação');
        });
        
    };

   
</script>

</body>
</html>